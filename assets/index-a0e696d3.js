var z=Object.defineProperty;var E=(t,s,i)=>s in t?z(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i;var h=(t,s,i)=>(E(t,typeof s!="symbol"?s+"":s,i),i);(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))a(c);new MutationObserver(c=>{for(const f of c)if(f.type==="childList")for(const x of f.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&a(x)}).observe(document,{childList:!0,subtree:!0});function i(c){const f={};return c.integrity&&(f.integrity=c.integrity),c.referrerPolicy&&(f.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?f.credentials="include":c.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function a(c){if(c.ep)return;c.ep=!0;const f=i(c);fetch(c.href,f)}})();var l=(t=>(t[t.wait_images_loading=0]="wait_images_loading",t[t.main_looping=1]="main_looping",t[t.paused=2]="paused",t[t.wait_user_start=3]="wait_user_start",t[t.wait_user_restart=4]="wait_user_restart",t))(l||{});const e={k:"",time:0,state:0,sprites:[]};var d=(t=>(t[t.Center=0]="Center",t[t.Pos=1]="Pos",t))(d||{}),w=(t=>(t[t.KilledEnemy=0]="KilledEnemy",t[t.Time=1]="Time",t))(w||{});const r={auto_start:!1,screen:{w:0,h:0},score_location_type:0,score_location:{x:10,y:10},score_format:"",score_type:0,init:()=>{},on_time_update:()=>{},on_collision:()=>{},on_j:()=>{},on_k:()=>{}},_=document.createElement("canvas"),n=_.getContext("2d");n&&(n.imageSmoothingEnabled=!1);const K=(t,s,i)=>{r.screen.w=s,r.screen.h=i,document.querySelector(t).innerHTML="",document.querySelector(t).appendChild(_),document.addEventListener("keydown",({code:a})=>{e.k=a}),document.addEventListener("keyup",()=>{e.k=""}),_.width=s,_.height=i},b=()=>{if(!n)return!1;n.clearRect(0,0,r.screen.w,r.screen.h),n.fillStyle="#ccc",n.fillRect(0,0,r.screen.w,r.screen.h)},p=(t,s,i)=>{if(!n)return!1;n.font="14px Segoe UI",n.textAlign="left",n.fillStyle="#000";const{x:a,y:c}=i;s&&(n.textAlign="center"),n.fillText(`${t}`,a,c)},P=()=>{b(),e.sprites.forEach(t=>{t.draw()})},y=[],O=t=>y.filter(s=>s.id===t)[0].img,C=(...t)=>{t.forEach(({id:s,src:i})=>{const a=new Image;a.src=i,y.push({id:s,img:a})})},A=()=>{const t=y.length,s=y.filter(({img:i})=>i.width!=0).length;b(),p(`${s}/${t}`,!0,{x:r.screen.w/2,y:r.screen.h/1.7}),console.log("auto",r.auto_start),(s>0&&s-t==0||t===0)&&(r.auto_start?e.state=l.main_looping:e.state=l.wait_user_start)},L=()=>{if(b(),p("Press S to Start",!0,{x:r.screen.w/2,y:r.screen.h/1.7}),e.k==="KeyS")return e.k="",e.state=l.main_looping,!1};class m{constructor(){h(this,"score");h(this,"type");h(this,"location");h(this,"size");h(this,"vector");h(this,"attributes");h(this,"data");this.score=0,this.type="",this.location={x:0,y:0},this.size={w:0,h:0},this.vector={x:0,y:0},this.attributes={name:null,img_id:null,color:"#000",can_outofscreen:!0,can_userctrl:!0,life:1,attack:1},this.data={}}on_update(s){}update(){this.location.x+=this.vector.x,this.location.y+=this.vector.y,this.attributes.can_outofscreen||(this.location.x<=0&&(this.location.x=0,this.vector.x=0),this.location.x+this.size.w>=r.screen.w&&(this.location.x=r.screen.w-this.size.w,this.vector.x=0),this.location.y<=0&&(this.location.y=0,this.vector.y=0),this.location.y+this.size.h>=r.screen.h&&(this.location.y=r.screen.h-this.size.h,this.vector.y=0)),this.on_update(this)}draw(){if(n)if(this.attributes.img_id){const s=O(this.attributes.img_id);n.drawImage(s,this.location.x,this.location.y,this.size.w,this.size.h)}else n.fillStyle=this.attributes.color,n.fillRect(this.location.x,this.location.y,this.size.w,this.size.h)}}class I extends m{constructor(){super(),this.attributes.can_outofscreen=!1,this.type="player"}update(){super.update()}}const o=new I;e.sprites.push(o);const g=t=>o.attributes[t]||o[t],u=(t,s)=>{t==="location"||t==="size"||t==="vector"?o[t]=s:o.attributes[t]=s},R=()=>{const t=e.sprites.filter(i=>i.type==="enemy"),s=e.sprites.filter(i=>i.type==="bullet");t.forEach(i=>{i.location.x<o.location.x+o.size.w*.75&&i.location.x+i.size.w*.75>o.location.x&&i.location.y<o.location.y+o.size.h*.75&&i.location.y+i.size.h*.75>o.location.y&&(o.attributes.life-=i.attributes.attack,i.attributes.life-=o.attributes.attack),s.forEach(a=>{i.location.x<a.location.x+a.size.w*.75&&i.location.x+i.size.w*.75>a.location.x&&i.location.y<a.location.y+a.size.h*.75&&i.location.y+i.size.h*.75>a.location.y&&(a.attributes.life-=i.attributes.attack,i.attributes.life-=a.attributes.attack,o.score+=1)})})},j=()=>{e.time+=1,r.on_time_update(e.time),e.k==="KeyP"&&(e.k="",e.state=l.paused),e.k===""&&o.attributes.can_userctrl&&(o.vector.x=0,o.vector.y=0),e.k==="KeyW"&&o.attributes.can_userctrl&&(o.vector.x=0,o.vector.y=-1),e.k==="KeyS"&&o.attributes.can_userctrl&&(o.vector.x=0,o.vector.y=1),e.k==="KeyA"&&o.attributes.can_userctrl&&(o.vector.x=-1,o.vector.y=0),e.k==="KeyD"&&o.attributes.can_userctrl&&(o.vector.x=1,o.vector.y=0),e.k==="KeyJ"&&(e.k="",r.on_j()),e.k==="KeyK"&&(e.k="",r.on_k()),e.sprites.forEach(s=>{s.update()});const t=r.score_format.replace("{{score}}",r.score_type===w.KilledEnemy?o.score:e.time);switch(r.score_location_type){case d.Center:p(t,!0,{x:r.screen.w/2,y:r.screen.h/1.7});break;case d.Pos:p(t,!1,r.score_location);break}R(),e.sprites.forEach((s,i)=>{if(s.attributes.life<1){if(s.type==="player")return e.state=l.wait_user_restart,!1;e.sprites.splice(i,1)}})},q=()=>{if(p("Paused",!0,{x:r.screen.w/2,y:r.screen.h/1.7}),e.k==="KeyP")return e.k="",e.state=l.main_looping,!1},F=()=>{p("Game Over",!0,{x:r.screen.w/2,y:r.screen.h/1.7}),e.k==="KeyR"&&(e.k="",o.score=0,e.time=0,r.init(),e.sprites.forEach((t,s)=>{t.type!="player"&&e.sprites.splice(s,1)}),e.sprites.forEach((t,s)=>{t.type!="player"&&e.sprites.splice(s,1)}),e.state=l.main_looping)},k=()=>{switch(e.state){case l.wait_images_loading:A();break;case l.main_looping:j();break;case l.wait_user_start:L();break;case l.wait_user_restart:F();break;case l.paused:q();break}requestAnimationFrame(()=>{P(),k()})};class N extends m{constructor(){super(),this.attributes.can_outofscreen=!0,this.type="enemy",this.vector.x=0,this.vector.y=0}update(){super.update()}}class $ extends m{constructor(){super(),this.attributes.can_outofscreen=!0,this.type="bullet",this.vector.x=-1}update(){super.update()}}class M extends m{constructor(){super(),this.attributes.can_outofscreen=!0,this.type="food",this.vector.x=-1,this.attributes.attack=0}update(){super.update()}}const B={make_enemy:()=>{const t=new N;return e.sprites.push(t),t},make_food:()=>{const t=new M;return e.sprites.push(t),t},make_bullet:()=>{const t=new $;return e.sprites.push(t),t}},D=()=>{r.init(),k()};K("#app",300,80);C({id:"dino",src:"./images/dino.png"},{id:"x",src:"./images/x.png"});const v=()=>{const t=B.make_enemy();t.location.x=300,t.location.y=48,t.size={w:20,h:28},t.vector.x=-2,t.attributes.img_id="x",t.on_update=s=>{s.location.x<=-20&&(s.attributes.life=0)}};r.init=()=>{u("can_userctrl",!1),u("can_outofscreen",!1),u("size",{w:25,h:25}),u("location",{x:10,y:50}),u("life",1),u("attack",0),u("img_id","dino"),v()};r.on_time_update=t=>{t%20==0&&u("color","#f00"),t%40==0&&u("color","#000"),t%200==0&&v(),g("location").y<=10&&u("vector",{x:0,y:1}),g("location").y>=50&&u("vector",{x:0,y:0})};r.on_j=()=>{g("location").y>=50&&u("vector",{x:0,y:-1})};r.score_location_type=d.Center;r.score_format="{{score}} m";r.score_type=w.Time;D();
